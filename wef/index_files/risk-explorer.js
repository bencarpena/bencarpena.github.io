(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,aa,ba,ca,da,ea,fa,ha,ia,ja,ka,la,ma,na,oa,pa,qa=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};Y=function(){var a;return a=this.getTotalLength(),d3.interpolateString("0,"+a,""+a+","+a)},F=function(){var a;return a=this.getTotalLength(),d3.interpolateString(""+a+","+a,"0,"+a)},A=function(a){return a[0].toUpperCase()+a.slice(1)},$.fn.qtip.defaults={prerender:!1,id:!1,overwrite:!0,suppress:!0,content:{text:!0,attr:"title",text:!1,button:!1},position:{my:"bottom center",at:"top center",target:"mouse",container:!1,viewport:$("body"),adjust:{x:0,y:-2,mouse:!0,resize:!0,method:"flip flip"},effect:function(a,b,c){return $(this).animate(b,{duration:300,queue:!1})}},show:{target:!1,event:"mouseenter touchstart",effect:!0,delay:500,solo:!1,ready:!1,modal:{on:!1,effect:!0,blur:!0,escape:!0}},hide:{target:!1,event:"mouseleave touchend",effect:!0,delay:0,fixed:!1,inactive:!1,leave:"window",distance:!1},style:{classes:"",widget:!1,width:!1,height:!1,tip:{corner:!0,mimic:!1,width:8,height:6,border:!0,offset:0}},events:{render:null,move:null,show:null,hide:null,toggle:null,visible:null,hidden:null,focus:null,blur:null}},E=function(){return"<iframe src='"+document.location+"' style='border:none; width: 100%; min-width: 700px; min-height:600px; margin: 1em 0;'></iframe>"},X=function(){return'<div class="share-popup">\n  <div class="row social">\n    <h4>Share on social networks</h4>\n    <a target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&url='+document.location+"&title="+encodeURIComponent(document.title)+"&summary="+encodeURIComponent("The 2020 edition of the Global Risks report completes a decade of highlighting the most significant long-term risks worldwide, drawing on the perspectives of experts and global decision-makers.")+'"><i class="icon-linkedin-squared"></i></a>\n    <a target="_blank" href="http://twitter.com/home?status='+encodeURIComponent(document.title)+" from @wef "+encodeURIComponent(document.location)+'" data-url=" "><i class="icon-twitter-squared"></i></a>\n    <a target="_blank" href="http://www.facebook.com/sharer.php?u='+encodeURIComponent(document.location)+"&t="+encodeURIComponent(document.title)+'"><i class="icon-facebook-squared"></i></a>\n  </div>\n  <div class="row">\n    <h4>Link to current view</h4>\n    <i class="icon-link"></i><input onClick="this.setSelectionRange(0, this.value.length); return false;" value="'+document.location+'" readonly="readonly" />\n  </div>\n  <div class="row">\n    <h4>Embed code</h4>\n    <i class="icon-code"></i>\n    <input onClick="this.setSelectionRange(0, this.value.length);" value="'+E()+'" readonly="readonly" />\n  </div>\n</div>'},$(function(){return $(".mobile.button").on("click",function(){return $(".navi ul").toggle(),!1}),$(".share").qtip({show:{event:"click",delay:0,ready:!1},hide:{event:"mouseout",fixed:!0,delay:400},position:{my:"bottom right",at:"top center",target:$(".share"),viewport:$("#wef-vis-widget"),adjust:{x:10,y:0}},style:{tip:{mimic:"bottom center",offset:20}},content:{text:function(a,b){return X()}}}).bind("click",function(a){return a.preventDefault(),!1})}),C={economic:"#0d81c4",geopolitical:"#e77e25",environmental:"#008753",societal:"#ec3827",technological:"#862575",trend:"#9FACC4"},B={economic:"Economic Risk",geopolitical:"Geopolitical Risk",environmental:"Environmental Risk",societal:"Societal Risk",technological:"Technological Risk",trend:"Trend"},e="-10,0 0,-10 10,0 0,10",l="-10,-15 50,0 -10,15 -30,0",S=function(a){return 3>a?["1st","2nd","3rd"][a]:""+(a+1)+"th"},M=22,N={R_NATIONALGOV:16,R_BIODIVERSITY:16,R_INTERSTATE:16,R_WEATHEREVENTS:16,R_FAILURECLIMATE:14,R_ASSET:14,R_STATECOLLAPSE:14,R_MIGRATION:21,T_INTERGOVERNANCE:15,R_NATIONALGOV:16,R_FAILUREURBAN:13},Z={risks:{R_WEATHEREVENTS:"end",R_BIODIVERSITY:"start",R_NATURALCATA:"start",R_CYBERATTACKS:"start",R_NATIONALGOV:"middle",R_TECHADV:"middle",R_MANMADECATA:"start",R_FOOD:"end",R_DATAFRAUD:"middle",R_FINANCIALMECH:"middle",R_CRITICALINFO:"start",R_FAILUREURBAN:"middle",R_WMD:"middle",R_TERRORIST:"middle",R_ENERGY:"middle",R_STATECOLLAPSE:"middle",R_WATER:"middle",R_FISCALCRISES:"start"},landscape:{R_FAILURECLIMATE:"middle",R_CYBERATTACKS:"end",R_WEATHEREVENTS:"middle",R_BIODIVERSITY:"middle",R_MANMADECATA:"start",R_WMD:"start",R_INFLATION:"start",R_INTERSTATE:"end",R_REGIONALGOV:"start",R_ASSET:"start",R_DATAFRAUD:"start",R_NATIONALGOV:"start",R_FISCALCRISES:"end",R_FINANCIALMECH:"end",R_UNEMPLOYMENT:"end",R_MIGRATION:"start",R_STATECOLLAPSE:"start",R_TECHADV:"middle",R_CRITICALINFRA:"end",R_INFECTIOUSDISEASES:"middle"}},aa={risks:{R_NATURALCATA:[0,-25],R_WEATHEREVENTS:[-5,-25],R_MANMADECATA:[10,-25],R_CRITICALINFRA:[-10,-25],R_CRITICALINFO:[-30,20],R_REGIONALGOV:[5,-40],R_FAILUREURBAN:[0,-65]},landscape:{R_INTERSTATE:[0,0],R_REGIONALGOV:[0,-45],R_MIGRATION:[5,-25],R_INTERSTATE:[0,-45],R_FISCALCRISES:[-5,-25],R_DATAFRAUD:[10,-13],R_UNEMPLOYMENT:[-5,-25],R_CRITICALINFRA:[-10,-20],R_NATIONALGOV:[10,-30],R_FINANCIALMECH:[-10,-25],R_TERRORIST:[-10,-15],R_STATECOLLAPSE:[10,-20]}},f=function(a){return{"Failure of major financial mechanism or institution":"#00529A","Fiscal crises in key economies":"#097DC2","Large-scale terrorist attacks":"#A71E5F","Liquidity crises":"#FBB817","Major escalation in organized crime and illicit trade":"#F16221","Oil price shock to the global economy":"#85C040","Profound political and social instability":"#008752","Prolonged neglect of critical infrastructure and its development needs":"#E03A93","Water crises":"#00A07F"}[a]},ia={business:["Business","Non-Business"],gender:["Male","Female"],age:["Young","Other"]},ha=["#00BBE3","#862074"],Q=function(a,b){return a.source===b?a.target:a.target===b?a.source:void 0},p=[],j=!0,P={},O=[],K=[],V=void 0,ba=void 0,D=void 0,I=void 0,J=void 0,r="trends",m="risks",i="landscape",k="trends",n=[],c="",g="",la=void 0,oa=void 0,ma=void 0,pa=void 0,ka=0,na=0,s=.05*Math.PI*2,a=-5,b=-28,u=[2.3,4.35],x=[2.8,4.1],v=[2.2,4.4],w=[2.6,4.4],y=null,z=null,q=void 0,d=window.WEF_WIDGET_DATA_URL||"./data",$(function(){return $("#wef-vis-widget").hasClass("risk-explorer")?(q=document.title,D=d3.select("#vis"),L()):void 0}),$(window).on("resize",function(){var a;return a=$("#wef-vis-widget").width(),$("#wef-vis-widget #vis svg").css({width:a,height:a})}),ea=function(){return location.hash=""+k+"/"+n+"/"+c+"/"+g},$("#wef-vis-widget .viewmode a:not(.mobile)").on("click",function(){return k=$(this).attr("href").replace("#",""),"landscape"!==k&&(c="",g=""),$(document).width()<=980?$("#wef-vis-widget .navi ul").hide():$("#wef-vis-widget .navi ul").show(),ea(),!1}),$("#wef-vis-widget .compare a").on("click",function(){return c=$(this).attr("href").replace("#",""),ea(),!1}),$("#wef-vis-widget .filter a").on("click",function(){return g=$(this).attr("href").replace("#",""),ea(),!1}),$("#wef-vis-widget .selection .clear.button").on("click",function(){return n=[],ea(),!1}),$("#wef-vis-widget #vis .clear.button").on("click",function(){return n=[],ea(),!1}),window.onhashchange=function(){var a,b;return b=location.hash.replace("#",""),a=null!=b?b.split("/"):void 0,k=void 0,(null!=a?a.length:void 0)>0&&(k=a[0]),k!==m&&k!==r&&k!==i&&(k=m),d3.select("#wef-vis-widget").classed("rim",k===m),(null!=a?a.length:void 0)>1?(n=a[1].split(","),n=_.filter(n,function(a){return P[a]})):n=[],c=(null!=a?a.length:void 0)>2?a[2]:"",g=(null!=a?a.length:void 0)>3?a[3]:"",T(),"undefined"!=typeof ga&&null!==ga?ga("send","pageview"):void 0},L=function(){var a,b,c,e,f;if(j)for(f=gexf.fetch(""+d+"/graph.gexf").nodes,a=c=0,e=f.length;e>c;a=++c)b=f[a],f[a]={id:b.id,viz:{position:b.viz.position}};else f=p;return d3.tsv(""+d+"/entities.tsv",function(c){return d3.tsv(""+d+"/connections.tsv",function(e){return d3.tsv(""+d+"/landscape-breakdown.tsv",function(d){var g,h,i,j,k,l,m,n,o,p,q,r,t,u,v,w,x,y,z,A,B,D,E,F,G,H,I,J,L,M,N,Q,R,S,T,U,X,Y,Z,$,aa,ca;for(F=0,I=c.length;I>F;F++){if(p=c[F],O.push(p),p.category=p.category.toLowerCase(),o=_.findWhere(d,{risk:p.id,group:"Overall"}),null!=o)for(p.likelihood=+o.likelihood,p.impact=+o.impact,p.landscapeDataByGroup={},ca=_.where(d,{risk:p.id}),G=0,J=ca.length;J>G;G++)B=ca[G],p.landscapeDataByGroup[B.group]={impact:+B.impact,likelihood:+B.likelihood};p.isTrend="trend"===p.category,p.color=C[p.category],P[p.id]=p,p.degree=0,p.trendDegree=0,p.riskLinks=[],p.trendLinks=[]}for(ka=d3.mean(O,function(a){return a.likelihood}),na=d3.mean(O,function(a){return a.impact}),e.sort(function(a,b){return b.strength-a.strength}),H=0,L=e.length;L>H;H++)l=e[H],u=P[l.source],w=P[l.target],k="trend"===u.category||"trend"===w.category,n={weight:+l.strength,source:u,target:w,isTrendLink:k},k?(u.trendDegree+=n.weight,w.trendDegree+=n.weight,u.trendLinks.push(n),w.trendLinks.push(n)):(u.degree+=n.weight,w.degree+=n.weight,u.riskLinks.push(n),w.riskLinks.push(n)),K.push(n);for(U=0,M=f.length;M>U;U++)b=f[U],j=b.id,q=b.viz.position,q.y*=-1,q.x-=q.x%100,q.y-=q.y%100,P[j].x=q.x,P[j].y=q.y;for(D=d3.scale.linear().domain(d3.extent(function(){var a,b,c;for(c=[],b=0,a=O.length;a>b;b++)p=O[b],c.push(p.x);return c}())).range([-.4,.4]),E=d3.scale.linear().domain(d3.extent(function(){var a,b,c;for(c=[],b=0,a=O.length;a>b;b++)p=O[b],c.push(p.y);return c}())).range([-.45,.45]),h=d3.scale.sqrt().domain([0,d3.max(function(){var a,b,c;for(c=[],b=0,a=O.length;a>b;b++)p=O[b],c.push(p.degree);return c}())]),y=d3.scale.sqrt().domain([0,d3.max(function(){var a,b,c;for(c=[],b=0,a=O.length;a>b;b++)p=O[b],c.push(p.trendDegree);return c}())]),X=0,N=O.length;N>X;X++)p=O[X],p.x=D(p.x),p.y=E(p.y),p.relDegree=h(p.degree),p.relTrendDegree=y(p.trendDegree);for(V=_.filter(O,function(a){return"trend"!==a.category}),ba=_.filter(O,function(a){return"trend"===a.category}),a=Y=0,Q=ba.length;Q>Y;a=++Y)v=ba[a],m=Math.sqrt(v.x*v.x+v.y*v.y),v.angle=Math.atan2(v.y,v.x);for(ba.sort(function(a,b){return a.angle-b.angle}),a=Z=0,R=ba.length;R>Z;a=++Z)v=ba[a],i=.5+a/ba.length,g=2*Math.PI*i+s,v.x=Math.cos(g)/1.5,v.y=Math.sin(g)/1.5,v.angle=Math.atan2(v.y,v.x);for(x=10,V.sort(function(a,b){return b.trendDegree-a.trendDegree}),a=$=0,S=V.length;S>$;a=++$)r=V[a],r.isInTopXTrendRisks=!0;for(A=d3.scale.sqrt().domain(d3.extent(function(){var a,b,c;for(c=[],b=0,a=K.length;a>b;b++)l=K[b],c.push(l.weight);return c}())),aa=0,T=K.length;T>aa;aa++)l=K[aa],l.weight=A(l.weight);return t=_.filter(O,function(a){return!a.isTrendLink}),z=_.filter(O,function(a){return a.isTrendLink}),W()})})})},t=800,h=800,R=0,H=40,o=Math.min(t,h)-2*R,ja=void 0,G=void 0,W=function(){var d,f,g,j,p,q,s,v,w,B,C,E,F,L,P,Q,S,T,V;for($("#wef-vis-widget .loading").hide(),$("#wef-vis-widget .vis-container").css("visibility","visible").slideDown(),ja=D.append("svg").attr({width:"100%",height:"100%"}).attr({viewBox:"0 0 "+t+" "+h,preserveAspectRatio:"xMinYMin meet"}).append("g").attr({transform:"translate("+[o/2+R,o/2+R]+")"}),w=ja.append("defs").append("linearGradient").attr({id:"linegradient",x1:"0%",x2:"0%",y1:"0%",y2:"100%"}),w.append("stop").attr({offset:"0%"}).style({"stop-color":ha[0]}),w.append("stop").attr({offset:"100%"}).style({"stop-color":ha[1]}),w=ja.select("defs").append("linearGradient").attr({id:"linegradientflipped",x1:"0%",x2:"0%",y1:"0%",y2:"100%"}),w.append("stop").attr({offset:"0%"}).style({"stop-color":ha[1]}),w.append("stop").attr({offset:"100%"}).style({"stop-color":ha[0]}),d=ja.append("rect").classed("bg",!0).attr({width:2*t,height:2*h,x:-t,y:-h}),L=d3.select(".plot-area svg"),L.attr({viewBox:"-5 -5 106 106",preserveAspectRatio:"xMinYMin meet"}),F=L.append("g"),q=T=0;3>=T;q=++T)F.append("line").classed("grid",!0).attr({x1:100*q/4,y1:100,x2:100*q/4,y2:0});for(q=V=0;3>=V;q=++V)F.append("line").classed("grid",!0).attr({y1:100*q/4,x1:100,y2:100*q/4,x2:0});return F.append("rect").classed("border",!0).attr({width:100,height:100}),F.append("rect").style("fill","#FFF").attr({width:7,height:7,x:-1,y:-1}),F.append("text").text("5").attr({x:0,y:3}),F.append("rect").style("fill","#FFF").attr({width:7,height:14,x:-1,y:90}),F.append("text").text("1").attr({x:0,y:100}),F.append("rect").style("fill","#FFF").attr({width:14,height:14,x:93,y:91}),F.append("text").text("5").attr({x:99,y:100}),F.append("rect").classed("visible-area",!0),d.on("click",function(a){return n=[],ea()}),G=ja.append("g"),v=-t/2+H,Q=-h/2+H/2,S=t-2*H,p=h-2*H,G.append("rect").classed("landscape-borders",!0).attr({width:S,height:p,x:v,y:Q}),I=d3.scale.linear().domain(u).range([v,v+S]),J=d3.scale.linear().domain(x).range([Q+p,Q]),la=d3.svg.axis().scale(I).tickSize(-p+15).ticks(4),ma=G.append("g").classed("axis",!0).attr({transform:"translate(0,"+(Q+p-8)+")"}).call(la),oa=d3.svg.axis().scale(J).tickSize(-p+15).orient("left").ticks(4),pa=G.append("g").classed("axis",!0).attr({transform:"translate("+(v+5)+",0)"}).call(oa),z=G.append("g").classed("avg-line",!0),z.append("line").attr({y1:Q,y2:Q+p}).style({stroke:"#AAAAAA"}),z.append("polygon").attr({points:"0,"+(Q+p-8)+" -7,"+(Q+p+6)+" 7,"+(Q+p+6)}).style({fill:"#AAAAAA",stroke:"white","stroke-width":"3px"}),z.append("text").attr({y:Q+p+20}).style({fill:"#444"}).text("Average"),z.append("text").attr({y:Q+p+35}).style({"font-weight":"bold",fill:"#444"}).text(ka.toFixed(2)),z.attr("transform","translate("+a+", 0)"),y=G.append("g").classed("avg-line",!0),y.append("line").attr({x1:v,x2:v+S}).style({stroke:"#AAAAAA"}),y.append("polygon").attr({points:"0,"+(Q+p-8)+" -7,"+(Q+p+6)+" 7,"+(Q+p+6)}).style({fill:"#AAAAAA",stroke:"white","stroke-width":"3px"}).attr("transform","rotate(90)translate(0,15)"),y.append("text").attr({x:v+10,y:-8}).style({fill:"#444"}).text("Average"),y.append("text").attr({x:v+10,y:15}).style({"font-weight":"bold",fill:"#444"}).text(na.toFixed(2)),y.attr("transform","translate(0, "+b+")"),U(),C=ja.append("g"),E=ja.selectAll(".node").data(O),j=E.enter().append("g").attr({"class":function(a){return"node "+a.category},transform:function(a){return"translate("+[0,0]+") scale(0)"}}),j.on("click tap",function(a){var b;return n=null!=n&&(b=a.id,qa.call(n,b)>=0)?_.without(n,a.id):[a.id],ea(),k===i?$(this).qtip("show",!0):$(".qtip").hide()}),j.each(function(a){return $(this).qtip({show:{delay:800},content:{text:function(b,d){return k===i?""!==c?'<span class="risk-label">'+a.label+'</span>\n<div class="details">\n	<div class="compare1">'+ia[c][0]+' respondents</div>\n	<div>\n		<span class="label">Likelihood<span>\n		<span class="value">'+a.data1.likelihood.toFixed(2)+'<span>\n	</div>\n	<div>\n		<span class="label">Impact<span>\n		<span class="value">'+a.data1.impact.toFixed(2)+'<span>\n	</div>\n</div>\n<div class="details">\n	<div class="compare2">'+ia[c][1]+' respondents</div>\n	<div>\n		<span class="label">Likelihood<span>\n		<span class="value">'+a.data2.likelihood.toFixed(2)+'<span>\n	</div>\n	<div>\n		<span class="label">Impact<span>\n		<span class="value">'+a.data2.impact.toFixed(2)+"<span>\n	</div>\n</div>":'<span class="risk-label">'+a.short_label+'</span>\n<div class="details">\n	<div>\n		<span class="label">Likelihood<span>\n		<span class="value">'+a.likelihood.toFixed(2)+'<span>\n	</div>\n	<div>\n		<span class="label">Impact<span>\n		<span class="value">'+a.impact.toFixed(2)+"<span>\n	</div>\n</div>":k===m?'<span class="risk-label">'+a.short_label+'</span>\n<div class="details rim">\n	<div>\n		<span class="'+a.category+'">'+A(a.category)+" risk</span>\n	</div>\n</div>":k===r?'<span class="risk-label">'+a.short_label+'</span>\n<div class="details rim">\n	<div>\n		<div>\n		<span class="'+a.category+'">'+A(a.category)+" "+("trend"!==a.category?"risk":"")+"</span>\n	</div>\n	</div>\n</div>":void 0}}})}),P=j.append("g").classed("symbol",!0),P.append("polygon").attr({points:function(a){return"trend"!==a.category?e:l},fill:function(a){return a.color}}).filter(function(a){return"trend"===a.category}).attr("transform",function(a){return"rotate("+180*a.angle/Math.PI+")"}),f=j.append("g").classed("compare-handle",!0),f.append("line").attr().style({stroke:"url(#linegradient)"}),f.append("circle").attr({r:5}),f.append("circle").attr({r:5}).classed("second",!0),s=j.append("g").attr("class",function(a){return"label-group "+a.id}),s.append("text").classed("bg",!0).tspans(function(a){return d3.wordwrap(a.short_label,N[a.id]||M)}),s.append("text").tspans(function(a){return d3.wordwrap(a.short_label,N[a.id]||M)}),g=C.selectAll(".link").data(K),j=g.enter().append("g").attr({"class":"link"}).style({opacity:0}),j.sort(function(a,b){return a.weight-b.weight}),j.append("path").style({stroke:"#FFF","stroke-width":function(a){return a.isTrendLink?9*a.weight:15*a.weight}}),B=j.append("path"),B.filter(function(a){return a.isTrendLink}).style({stroke:function(a){var b;return b=a.target.color},"stroke-width":function(a){return 3*a.weight}}),B.filter(function(a){return!a.isTrendLink}).style({stroke:function(a){return d3.hsl(0,0,.3+.7*(1-Math.sqrt(a.weight)))},"stroke-width":function(a){return 4*a.weight}}),$(window).trigger("hashchange"),$(window).trigger("resize")},U=function(){return ma.transition().duration(600).call(la),pa.transition().duration(600).call(oa),ma.selectAll(".tick").selectAll("rect").data([1]).enter().append("rect").attr({x:-15,y:-5,width:30,height:20}).style("fill","#FFF"),ma.selectAll("text").each(function(){return this.parentNode.appendChild(this)}),pa.selectAll(".tick").selectAll("rect").data([1]).enter().append("rect").attr({x:-12,y:-10,width:20,height:20}).style("fill","#FFF"),pa.selectAll("text").each(function(){return this.parentNode.appendChild(this)}),d3.selectAll(".plot-area svg .visible-area").transition().attr({x:(I.domain()[0]-1)/4*100,y:100-(J.domain()[1]-1)/4*100,width:100*(I.domain()[1]-I.domain()[0])/4,height:100*(J.domain()[1]-J.domain()[0])/4})},T=function(){var a,b,d,e,f,h,j,l,p,s,t,y,z,A,B,C,D,E,F,H,L,M,N,Q,R,S,T,V,W,X,ba,ea,ga,ha,ka,la,ma;if(d3.selectAll(".navi a, .menu a").classed({active:function(a){return $(this).attr("href")==="#"+k}}),A=1,d3.select("#rim-legend").style("display",k!==i?"block":"none"),d3.select("#tim-legend").style("display",k===r?"block":"none"),k===m){for(C=function(a){return.75*a.relDegree+.33},L=0,R=K.length;R>L;L++)l=K[L],l.visible=!l.isTrendLink;for(M=0,S=O.length;S>M;M++)y=O[M],y.visible=!y.isTrend;d3.select("#wef-vis-widget h2").text("The Global Risks Interconnections Map 2020"),A=.9}else if(k===r){for(C=function(a){return Math.sqrt(a.relTrendDegree)},N=0,T=K.length;T>N;N++)l=K[N],l.visible=l.isTrendLink;for(Q=0,V=O.length;V>Q;Q++)y=O[Q],y.visible=!y.isTrend;d3.select("#wef-vis-widget h2").text("The Risks-Trends Interconnections Map 2020"),A=.6}else{for(C=function(a){return.5},ga=0,W=K.length;W>ga;ga++)l=K[ga],l.visible=!1;for(ha=0,X=O.length;X>ha;ha++)y=O[ha],y.visible=!y.isTrend;d3.select("#wef-vis-widget h2").text("The Global Risks Landscape 2020"),H=[],""===c?(I.domain(u),J.domain(x)):(I.domain(v),J.domain(w)),U()}if(fa(),ca(),da(),B=P[n[0]],k!==r&&(null!=B?B.isTrend:void 0)&&(B=null),B&&(k===m||k===r)){for(t=0,ka=0,ba=O.length;ba>ka;ka++)for(y=O[ka],y.connectionStrength=0,ma=_.filter(K,function(a){return a.visible&&(a.source===y&&a.target===B||a.target===y&&a.source===B)}),la=0,ea=ma.length;ea>la;la++)p=ma[la],y.connectionStrength+=p.weight,t=Math.max(y.connectionStrength,t);C=function(a){var b;return b=a.id,qa.call(n,b)>=0?1:Math.sqrt(a.connectionStrength/t)}}return document.title=d3.select("h3").text()+" | "+q,E=ja.transition().duration(1200),d=ja.selectAll(".node").transition().duration(800).delay(function(a,b){return 200*Math.pow(b/O.length,.8)}),b=E.selectAll(".link"),d.each(function(a){var b;return k!==i?(a.xPos=a.x*o*A,a.yPos=a.y*o*A,k===m&&(a.yPos-=50)):""===c?(a.xPos=I((null!=a?a.likelihood:void 0)||0),a.yPos=J((null!=a?a.impact:void 0)||0)):(b=ia[c],null!=a.landscapeDataByGroup&&(a.data1=a.landscapeDataByGroup[b[0]],a.data2=a.landscapeDataByGroup[b[1]],a.xPos=I(a.data1.likelihood||0),a.yPos=J(a.data1.impact||0),a.comparePosX=I(a.data2.likelihood||0),a.comparePosY=J(a.data2.impact||0),a.diff=Math.abs(a.data2.likelihood-a.data1.likelihood)+Math.abs(a.data2.impact-a.data1.impact))),a.pos=[a.xPos,a.yPos]}),d.sort(function(a,b){return C(a)-C(b)}),d.filter(function(a){return"trend"===a.category}).attr("opacity",function(a){return k!==r?0:1}),d.selectAll("text").style("fill",function(a){return k!==i?d3.hsl(0,0,1-C(a)):d3.hsl(0,0,.6-.2*((a.likelihood-3.5)/7+(a.impact-3.9)/7))}),d.selectAll("text").style({"text-anchor":function(a){var b,d;return b="start",b=k===i&&""!==c?"start":(null!=(d=Z[k])?d[a.id]:void 0)?Z[k][a.id]:a.isTrend?"middle":a.xPos<-.15*o*A?"end":a.xPos<.2*o*A?"middle":"start",a.anchor=b,b}}),d.selectAll(".label-group").attr({transform:function(a){var b,d,e,f;return"trend"===a.category?(e=75*a.y,e=e>0?Math.max(30,e):Math.min(-30,e),b=[85*a.x,e]):b={start:[9,18],middle:[0,25],end:[-9,18]}[a.anchor]||[0,25],k===i&&""!==c||!(d=null!=(f=aa[k])?f[a.id]:void 0)||(b[0]+=d[0],b[1]+=d[1]),"translate("+b+")"}}).style("opacity",1),G.attr("opacity",function(a){return k!==i?0:1}),E.selectAll(".avg-line").attr("opacity",function(a){return k!==i||""!==c?0:1}),z=d.filter(function(a){return a.visible}),z.style("opacity",1),k===i?(d3.select("#landscape-axes-legend").transition().style("opacity",1),d.attr({transform:function(a){return a.visible?(A=a.likelihood/5+.2,"translate("+((null!=a?a.pos:void 0)||[0,0])+")scale("+A+")"):"translate("+((null!=a?a.pos:void 0)||[0,0])+")scale(0)"}}).selectAll("text").style("opacity",1).attr("transform","scale(1)"),""!==g?z.style("opacity",function(a){return a.category===g?(a.hidden=!1,1):(a.hidden=!0,0)}):z.style("opacity",function(a){return a.hidden=!1,1}),""===c?(z.selectAll(".compare-handle circle").attr({cx:0,cy:0}).style({opacity:0}),z.selectAll(".compare-handle line").attr({x1:0,x2:0,y1:0,y2:0}).style({opacity:0}),z.selectAll("text").attr({opacity:1}),d.select(".label-group").attr({visibility:"visible"}),z.selectAll(".symbol").attr({transform:"scale(1.5)"}),f=d3.scale.linear().domain(d3.extent(O,function(a){return a.impact})).range([.66,0]).clamp(!0),z.selectAll("polygon").style({fill:function(a){var b;return a.impact<3.6?(b=a.color,b=d3.hsl(a.color).brighter(f(a.impact)),b=d3.interpolateRgb(b,"#FFFFFF")(.5*f(a.impact))):a.color}})):(h=.66,F=function(){var a,b,c;for(c=[],b=0,a=O.length;a>b;b++)j=O[b],j.hidden||c.push(j.diff);return c}(),F.sort(function(a,b){return b-a}),a=3,D=F[Math.min(F.length,a)-1],d.each(function(a){return a.comparePoint=[(a.comparePosX-a.xPos)/h,(a.comparePosY-a.yPos)/h]}).selectAll(".label-group").attr({visibility:function(a,b){return B?a===B?"visible":"hidden":!a.hidden&&a.diff>=D?"visible":"hidden"}}).style({opacity:1}).attr({transform:function(a){var b,c,d,e;return a.comparePoint[1]<0?(d=[a.comparePoint[0]+10,a.comparePoint[1]-10],b=d[0],c=d[1]):(e=[10,-10],b=e[0],c=e[1]),"translate("+[b,c]+")scale("+.85/h+")"}}),z.selectAll("text").attr({opacity:1}),z.attr({transform:function(a){return"translate("+(null!=a?a.pos:void 0)+")scale("+h+")"}}),z.selectAll(".compare-handle").style({opacity:1}),d.selectAll(".label-group"),z.selectAll(".symbol").attr({transform:"scale(0)"}),z.selectAll(".compare-handle circle.second").attr({cx:function(a){return a.comparePoint[0]},cy:function(a){return a.comparePoint[1]}}),z.selectAll(".compare-handle circle").style({opacity:1}),z.selectAll(".compare-handle line").attr({x1:function(a){return a.comparePoint[0]},y1:function(a){return a.comparePoint[1]}}).style({opacity:1,stroke:function(a){return a.comparePosY-a.yPos>0?"url(#linegradient)":"url(#linegradientflipped)"}}),z.selectAll(".compare-handle").style({opacity:function(a,b){return B&&B!==a||!B&&a.diff<D||a.hidden?.25:(this.parentNode.parentNode.appendChild(this.parentNode),1)}}))):(d3.select("#landscape-axes-legend").transition().style("opacity",0),d.select(".label-group").attr({visibility:function(a){return"visible"}}).style("opacity",function(a){return null==B||C(a)>0?1:0}),d.selectAll(".compare-handle").style("opacity",0),d.attr({transform:function(a){return"translate("+a.pos+")scale("+Math.max(.3,C(a))+")"}}).selectAll("text, .symbol").style("opacity",1).attr({transform:"scale(1.2)"}).selectAll("polygon").style({opacity:1,fill:function(a){return d3.hcl(a.color).brighter(3*(1-Math.sqrt(C(a))))}}),d.filter(function(a){return a.visible&&0===C(a)}).attr("opacity",1).attr({transform:function(a){return"translate("+a.pos+")scale(0.3)"}}).selectAll("text").style("opacity",0)),ja.selectAll(".node").classed("selected",function(a){var b;return b=a.id,qa.call(n,b)>=0}),b.filter(function(a){return a.visible}).style("visibility","visible"),b.filter(function(a){return!a.visible}).style("opacity",0).each("end",function(){return d3.select(this).style("visibility","hidden")}),null==B?k===r?(d.filter(function(a,b){return a.visible}).filter(function(a,b){return!a.isInTopXTrendRisks}).selectAll("text").style("opacity",0),Q=b.filter(function(a){return a.visible}).style("opacity",function(a){return Math.max(.01,Math.sqrt(a.weight))})):Q=b.filter(function(a){return a.visible}).style("opacity",1):Q=b.filter(function(a){return a.visible}).style("opacity",function(a){return Math.max(.2,Math.sqrt(C(a.source)*C(a.target)))}),k!==i?(s=ja.selectAll(".link").filter(function(a){return a.visible}),s.selectAll("path").attr({d:function(a){var b,c,d,e;return d=(a.source.xPos+a.target.xPos)/2,e=(a.source.yPos+a.target.yPos)/2,c=Math.sqrt(d*d+e*e),b=1+Math.pow(c/5e4,.5),d3.svg.line().interpolate("bundle")([[a.source.xPos,a.source.yPos],[b*d,b*e],[a.target.xPos,a.target.yPos]])}}),e=ja.selectAll(".link").filter(function(a){return a.visible}).filter(function(){return"hidden"===d3.select(this).style("visibility")}),e.selectAll("path").attr("stroke-dasharray","0,2000"),e.transition().duration(800).delay(function(a,b){return 1500*Math.pow(b/K.length,.8)}).selectAll("path").attrTween("stroke-dasharray",Y)):void 0},fa=function(){var a,b,d,e,f,h,j,l,o,p;return j=$("#wef-vis-widget .selection"),a=$("#wef-vis-widget #vis .clear.button"),l=P[n[0]],$("#wef-vis-widget").attr("class","wrapper risk-explorer "+k),l&&k===i?a.slideDown(300):a.slideUp(300),null!=l&&k!==i?(j.slideDown(300),j.find("#label").html(l.label),j.find("#description").html(l.description),l.isTrend?(j.find("h4.selection-type").html("Selected trend"),j.find("#impact").slideUp(),j.find("#likelihood").slideUp(),j.find(".most-connected.trends").slideDown(),j.find(".most-connected.risks").slideUp(),j.find(".most-connected.trends h4").text("Risks most strongly driven by this trend:"),e=l.trendLinks[Math.min(l.trendLinks.length-1,2)].weight,p=l.trendLinks.filter(function(a){return a.weight>=e}),f=d3.select(".most-connected.trends").selectAll(".connection").data(p),f.enter().append("div").classed("connection",!0),f.exit().remove(),f.on("click",function(a){return n=[Q(a,l).id],ea()}).text(function(a){return Q(a,l).short_label})):(j.find("h4.selection-type").html("Selected risk"),j.find("#impact").slideDown(),j.find("#impact .value").html(l.impact.toFixed(2)),j.find("#likelihood").slideDown(),j.find("#likelihood .value").html(l.likelihood.toFixed(2)),k===m?(j.find(".most-connected.trends").slideUp(),j.find(".most-connected.risks").slideDown(),e=l.riskLinks[Math.min(l.riskLinks.length-1,2)].weight,p=l.riskLinks.filter(function(a){return a.weight>=e}),f=d3.select(".most-connected.risks").selectAll(".connection").data(p),f.enter().append("div").classed("connection",!0),f.exit().remove(),f.on("click",function(a){return n=[Q(a,l).id],ea()}).text(function(a){return Q(a,l).short_label})):(j.find(".most-connected.trends").slideDown(),j.find(".most-connected.risks").slideUp(),j.find(".most-connected.trends h4").text("Trends most strongly driving this risk:"),e=l.trendLinks[Math.min(l.trendLinks.length-1,2)].weight,p=l.trendLinks.filter(function(a){return a.weight>=e}),f=d3.select(".most-connected.trends").selectAll(".connection").data(p),f.enter().append("div").classed("connection",!0),f.exit().remove(),f.on("click",function(a){return n=[Q(a,l).id],ea()}).text(function(a){return Q(a,l).short_label}))),j.find("#category .value span").removeClass().addClass(l.category).html(B[l.category])):j.slideUp(300),o=$("#wef-vis-widget #subtitle"),k===m?($("#wef-vis-widget .note div").hide(),$("#wef-vis-widget .note div.rim").show(),$("#wef-vis-widget .plot-area").slideUp(300),null!=l?o.html("Which global risks are most connected to <span class='"+l.category+"'>"+l.label+"</span>?"):o.html("How are global risks interconnected?")):k===r?($("#wef-vis-widget .note div").hide(),$("#wef-vis-widget .note div.trim").show(),$("#wef-vis-widget .plot-area").slideUp(300),null!=l?l.isTrend?o.html("Which global risks are most connected to the trend <span class='"+l.category+"'>"+l.label+"</span>?"):o.html("Which trends are most connected to the global risk <span class='"+l.category+"'>"+l.label+"</span>?"):o.html("How are global trends connected to global risks?")):($("#wef-vis-widget .note div").hide(),$("#wef-vis-widget .note div.landscape").show(),$("#wef-vis-widget .plot-area").slideDown(300),"expert"===c?$("#wef-vis-widget .note.expert").show():$("#wef-vis-widget .note.expert").hide(),b="",d="",""!==c&&(b=', as seen by <span class="compare1">'+ia[c][0].toLowerCase()+'</span> vs. <span class="compare2">'+ia[c][1].toLowerCase()+"</span> respondents",d="The risks with the three largest differences between groups of respondents are highlighted automatically."),h="",h="technological"===g&&""!==c?"<span class='black'>"+g+"</span> ":""!==g?"<span class='"+g+"'>"+g+"</span> ":"global ",o.html("What is the impact and likelihood of "+h+"risks"+b+"? "+d))},ca=function(){var a,b;return b=$("#wef-vis-widget .panel.compare"),k!==i?b.slideUp(300):b.slideDown(300),b.find("a").removeClass("active"),a=b.find("a[href='#"+c+"']"),a.hasClass("clear")?b.find(".clear").slideUp(300):(a.addClass("active"),b.find(".clear").slideDown(300))},da=function(){var a,b;return b=$("#wef-vis-widget .panel.filter"),k!==i?b.slideUp(300):b.slideDown(300),b.find("a").removeClass("active"),a=b.find("a[href='#"+g+"']"),a.hasClass("clear")?b.find(".clear").slideUp(300):(a.addClass("active"),b.find(".clear").slideDown(300))}}).call(this);